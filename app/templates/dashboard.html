{% extends 'base.html' %}

{% block content %}
<div class="dashboard-container">
    <h1>MQTT Dashboard</h1>
    <form action="{{ url_for('dashboard.dashboard') }}" method="POST">
        <input type="text" name="message" placeholder="Enter message to publish">
        <button type="submit">Publish</button>
    </form>
    {% if last_message %}
    <p>Last published message: {{ last_message }}</p>
    {% endif %}
    <ul id="messages">
        {% for message in messages %}
            <li>{{ message }}</li>
        {% endfor %}
    </ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script type="text/javascript">
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        // Listen for MQTT messages from the server
        socket.on('mqtt_message', function(data) {
            var li = document.createElement('li');
            li.appendChild(document.createTextNode(data.message));
            document.getElementById('messages').appendChild(li);
        });
    </script>
</div>
{% endblock %}
